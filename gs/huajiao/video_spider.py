# -*- coding:utf-8 -*-
import requests
from bs4 import BeautifulSoup
import re


def get_html(id):
    headers = {
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',
        'Accept-Encoding': 'gzip, deflate',
        'Accept-Language': 'zh-CN,zh;q=0.9',
        'Cache-Control': 'no-cache',
        'Connection': 'keep-alive',
        'Cookie': 'logid=5f1a788b5ab5d949563dbaa21d971d2f; user_rand=543a94056e699ac5c3906ab252f7669c; __guid=139759029.3175068874330589000.1561944697613.0452; __DC_sid=139759029.1833776435527564300.1561944697629.388; userid=172892622; token=YmIKTiHOXRq0AOtwvQ--6EvlhyDLkQL22536; gtoken=4aebeb6335758e864fa5c7be1057fe4a5a4d42fb; sign=WEH_dCnrIgbY_821YgqyZVNKj_ir25EN.VJJnINqPpTUzdeDWuHbxgbXMEKqzSEl; user_signature=d0149633a54bb04237e62e60af54c7ad; UM_distinctid=16bab28c98c14b-0ee6bac004b12c-3a65420e-1fa400-16bab28c98d3e7; pc_player_vol=0; CNZZDATA1255745025=566892443-1561944215-%7C1561944215; monitor_count=33; count=33; __DC_monitor_count=34; __DC_gid=139759029.281090940.1561944697628.1561949015830.33',
        'Host': 'www.huajiao.com',
        'Pragma': 'no-cache',
        'Referer': 'http://www.huajiao.com/user/136020733',
        'Upgrade-Insecure-Requests': '1',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36'}
    a = requests.get('http://www.huajiao.com/l/{}'.format(id), headers=headers)
    soup = BeautifulSoup(a.content, 'lxml')
    return re.match(r'.+\"m3u8\":\"([^\"]+)\".+', soup.text.encode('utf8').replace('\n', '')).group(1)


def process_m3u8(data):
    filename = data[0].replace("-", '').replace(":", "").replace(" ", "") + '.ts'
    a = requests.get(data[1])
    res = a.content.split('\n')
    ts_list = []
    for line in res:
        if '.ts' in line:
            ts_list.append(line)
    for ts in ts_list:
        r = requests.get("http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/{}".format(ts))
        with open("D:/huajiao/" + filename, 'ab') as f:
            f.write(r.content)

    pass


if __name__ == '__main__':
    ids = [['2019-04-21 09:00:49', 273445229], ['2019-04-07 10:55:45', 271573487],
           ['2019-04-07 10:55:06', 271573419], ['2019-04-07 10:43:55', 271572298], ['2019-03-31 09:37:14', 270540735],
           ['2019-01-20 10:09:33', 260914197], ['2019-01-20 09:19:24', 260910109], ['2019-01-13 09:17:40', 260009495],
           ['2019-01-06 09:20:42', 258939076], ['2018-12-31 08:46:43', 258178450], ['2018-12-30 09:16:12', 258058185],
           ['2018-12-23 09:13:40', 257236883], ['2018-12-16 09:07:25', 256320846], ['2018-12-09 10:59:40', 255390803],
           ['2018-12-09 09:18:28', 255382419], ['2018-11-25 09:14:36', 253566205], ['2018-11-18 09:16:48', 252680843],
           ['2018-11-04 10:58:31', 250825643], ['2018-11-04 09:22:16', 250817827], ['2018-10-28 10:49:19', 249901046],
           ['2018-10-21 09:09:48', 248962495], ['2018-10-14 09:19:24', 248052033], ['2018-10-07 09:04:31', 247145647],
           ['2018-09-30 09:55:11', 246262528], ['2018-09-30 09:06:20', 246259294], ['2018-09-16 09:09:12', 244528791],
           ['2018-09-02 09:04:50', 242640510], ['2018-08-19 09:21:05', 240748933], ['2018-08-12 09:06:15', 239762682],
           ['2018-08-05 08:59:45', 238762291], ['2018-07-29 08:59:35', 237724379], ['2018-07-22 09:07:09', 236688286],
           ['2018-07-15 09:02:11', 235669708], ['2018-07-01 09:09:54', 233629921], ['2018-06-24 09:15:13', 232631775],
           ['2018-06-17 10:09:02', 231609547], ['2018-06-17 09:37:08', 231606762], ['2018-06-17 09:08:03', 231604345],
           ['2018-06-10 10:58:00', 230592355], ['2018-06-10 09:13:49', 230582613], ['2018-06-03 11:04:27', 229558088],
           ['2018-06-03 09:07:03', 229546525], ['2018-05-27 09:09:46', 228518684], ['2018-05-13 10:58:33', 226257971],
           ['2018-05-06 09:06:17', 224504981], ['2018-04-29 09:13:26', 222740252], ['2018-04-22 09:09:25', 220889838],
           ['2018-04-15 09:05:11', 218917655], ['2018-04-08 09:14:55', 216751579], ['2018-03-25 10:25:53', 211711533],
           ['2018-03-18 09:09:06', 209399057], ['2018-03-11 09:10:14', 207774500], ['2018-03-04 09:10:49', 206271820],
           ['2018-02-25 09:08:14', 204782882], ['2018-02-18 09:11:37', 203382690], ['2018-02-11 09:21:28', 201972043],
           ['2018-02-04 09:20:35', 200427453], ['2018-01-14 11:13:26', 194847728], ['2018-01-14 09:12:16', 194824763],
           ['2018-01-07 09:14:24', 192903940], ['2018-01-04 19:36:50', 192159362], ['2017-12-24 09:29:41', 188883248],
           ['2017-12-21 20:28:12', 188171406], ['2017-11-26 09:12:06', 180992585], ['2017-11-12 09:17:32', 176088409],
           ['2017-10-22 08:12:56', 168291236]]
    m3u8_list = [['2019-04-21 09:00:49',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315558084441150982_OX_1555811567.m3u8'],
                 ['2019-04-07 10:55:45',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315546057431221444_SX_1554605849.m3u8'],
                 ['2019-04-07 10:55:06',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315546057041386388_SX_1554606061.m3u8'],
                 ['2019-04-07 10:43:55',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315546050341560357_OX_1554606003.m3u8'],
                 ['2019-03-31 09:37:14',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315539962151022310_SX_1553998314.m3u8'],
                 ['2019-01-20 10:09:33',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315479501151712401_OX_1547955505.m3u8'],
                 ['2019-01-20 09:19:24',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315479471501349548_OX_1547950085.m3u8'],
                 ['2019-01-13 09:17:40',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315473422461085725_OX_1547349485.m3u8'],
                 ['2019-01-06 09:20:42',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315467376281718367_OX_1546747264.m3u8'],
                 ['2018-12-31 08:46:43',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315462171831563383_OX_1546218901.m3u8'],
                 ['2018-12-30 09:16:12',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315461325381263510_SX_1546142127.m3u8'],
                 ['2018-12-23 09:13:40',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315455275921039532_OX_1545537337.m3u8'],
                 ['2018-12-16 09:07:25',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315449224281935847_SX_1544931784.m3u8'],
                 ['2018-12-09 10:59:40',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315443243651955775_SX_1544327354.m3u8'],
                 ['2018-12-09 09:18:28',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_ps4_non_13602073315443182891233924_OX_1544324527.m3u8'],
                 ['2018-11-25 09:14:36',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315431084731208853_OX_1543119678.m3u8'],
                 ['2018-11-18 09:16:48',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315425037081535595_SX_1542514221.m3u8'],
                 ['2018-11-04 10:58:31',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315413001941875401_OX_1541304059.m3u8'],
                 ['2018-11-04 09:22:16',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315412944951341467_OX_1541299744.m3u8'],
                 ['2018-10-28 10:49:19',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315406948971777762_SX_1540698963.m3u8'],
                 ['2018-10-21 09:09:48',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315400841711742422_OX_1540092338.m3u8'],
                 ['2018-10-14 09:19:24',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315394799371200759_SX_1539488407.m3u8'],
                 ['2018-10-07 09:04:31',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315388742531391328_OX_1538883909.m3u8'],
                 ['2018-09-30 09:55:11',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315382725001969491_SX_1538278623.m3u8'],
                 ['2018-09-30 09:06:20',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315382695631080490_SX_1538272487.m3u8'],
                 ['2018-09-16 09:09:12',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315370601071840552_SX_1537063766.m3u8'],
                 ['2018-09-02 09:04:50',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315358502581734960_OX_1535860406.m3u8'],
                 ['2018-08-19 09:21:05',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket/_LC_AL2_non_13602073315346416471952513_OX_1534650157.m3u8'],
                 ['2018-08-12 09:06:15',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket/_LC_AL2_non_13602073315340359611329499_OX_1534045218.m3u8'],
                 ['2018-08-05 08:59:45',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket/_LC_JD1_non_13602073315334307231627252_OX_1533440506.m3u8'],
                 ['2018-07-29 08:59:35',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315328259411620747_OX_1532834873.m3u8'],
                 ['2018-07-22 09:07:09',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_AL2_non_13602073315322215721347961_OX.m3u8'],
                 ['2018-07-15 09:02:11',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_AL2_non_13602073315316164791947304_OX.m3u8'],
                 ['2018-07-01 09:09:54',
                  'http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_QH2_non_13602073315304073611884717_OX_1530416749.m3u8'],
                 ['2018-06-24 09:15:13',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_QH2_non_13602073315298028961417837_SX.m3u8'],
                 ['2018-06-17 10:09:02',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315292013241137175_SX.m3u8'],
                 ['2018-06-17 09:37:08',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_QH2_non_13602073315291994261653486_OX.m3u8'],
                 ['2018-06-17 09:08:03',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_AL2_non_13602073315291976531943163_OX.m3u8'],
                 ['2018-06-10 10:58:00',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_AL2_non_13602073315285991941185712_OX.m3u8'],
                 ['2018-06-10 09:13:49',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315285931811289367_OX.m3u8'],
                 ['2018-06-03 11:04:27',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315279950541844479_OX.m3u8'],
                 ['2018-06-03 09:07:03',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315279879851093168_OX.m3u8'],
                 ['2018-05-27 09:09:46',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315273833771277879_SX.m3u8'],
                 ['2018-05-13 10:58:33',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315261802561335313_SX.m3u8'],
                 ['2018-05-06 09:06:17',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315255687381230113_OX.m3u8'],
                 ['2018-04-29 09:13:26',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_XY0_non_13602073315249643891481133_OX.m3u8'],
                 ['2018-04-22 09:09:25',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315243593341662193_SX.m3u8'],
                 ['2018-04-15 09:05:11',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315237542891770472_OX.m3u8'],
                 ['2018-04-08 09:14:55',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315231500751922328_SX.m3u8'],
                 ['2018-03-25 10:25:53',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_AL2_non_13602073315219447471300936_SX.m3u8'],
                 ['2018-03-18 09:09:06',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315213353301158257_OX.m3u8'],
                 ['2018-03-11 09:10:14',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315207305831927203_OX.m3u8'],
                 ['2018-03-04 09:10:49',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315201258311345427_OX.m3u8'],
                 ['2018-02-25 09:08:14',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315195208711840497_SX.m3u8'],
                 ['2018-02-18 09:11:37',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315189162921732729_OX.m3u8'],
                 ['2018-02-11 09:21:28',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_AL2_non_13602073315183120811454485_OX.m3u8'],
                 ['2018-02-04 09:20:35',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_ps4_non_13602073315177072251973695_OX.m3u8'],
                 ['2018-01-14 11:13:26',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315158995961824717_SX.m3u8'],
                 ['2018-01-14 09:12:16',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315158923261692345_OX.m3u8'],
                 ['2018-01-07 09:14:24',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_XY0_non_13602073315152876491478862_OX.m3u8'],
                 ['2018-01-04 19:36:50',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_XY0_non_13602073315150657961722300_OX.m3u8'],
                 ['2017-12-24 09:29:41',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_RE_non_13602073315140789701578205_SX.m3u8'],
                 ['2017-12-21 20:28:12',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket-bj/_LC_RE_non_13602073315138592881983550_SX.m3u8'],
                 ['2017-11-26 09:12:06',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_XY0_non_13602073315116587061192150_OX.m3u8'],
                 ['2017-11-12 09:17:32',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_XY0_non_13602073315104494341724218_OX.m3u8'],
                 ['2017-10-22 08:12:56',
                  'http://vod.cdn.huajiao.com/huikan_huajiao/vod-bucket/_LC_ps4_non_13602073315086310951867689_OX.m3u8']]
    for m3u8 in m3u8_list:
        process_m3u8(m3u8)
    # process_m3u8(file_path='http://vod.cdn.huajiao.com/live_huajiao_v2/vod-bucket-bj/_LC_AL2_non_13602073315462171831563383_OX_1546218901.m3u8')